# 上下文无关文法
对于高级程序语言和它的编译程序来讲，语言的语法定义是非常重要的。本段介绍语法结构的形式描述，重点讲解上下文无关文法、分析树、二义性三个问题。  
## 前置概念
∑：有穷字母表，其中每个元素称为符号。构建于∑上的符号串是由∑中任意的有限数量的符号构成的有穷序列，不包含任何符号的序列称为空字，记为ε₀。
比如说一个∑={a,b}，那么∑﹡是∑中所有符号组成的有穷字符串的集合，∑﹡={ε₀,a,b,ab,ba,aab,abb,bba,baa,......}，读作 ∑的闭包。  
## 定义
上下文无关文法，是一种它所定义的语法单位完全独立于该语法单位所处的环境的文法。比如一个程序中的算术表达式，我们可以不考虑程序的上下文对它进行单独的处理。对于现今的程序语言，上下文无关文法基本是够用的。因此以下部分中凡未显式说明的“文法”均指上下文无关文法。  
下面从一个英文句子引入上下文无关文法，比如：  
He gave me a book.  
对于这个句子，如果用->表示“由…组成”，那么可以有以下规则：  

```
句子->主语+谓语+间接宾语+直接宾语+界符
主语->代词
谓语->动词
间接宾语->代词
直接宾语->冠词+名词
代词->He | me
冠词->a
动词->gave
名词->book
界符->.
```

把给定的句子和上面的规则进行对照，检查语法单位是否处于正确的位置，我们可以得出：“给定的句子是一个语法正确的句子”。换个说法就是，我们可以从已有的规则推导/产生出给定的句子，比如：  
```
句子=>主语+谓语+间接宾语+直接宾语+界符
   =>代词+谓语+间接宾语+直接宾语+界符
   =>He 谓语+间接宾语+直接宾语+界符
   =>He 动词+间接宾语+直接宾语+界符
   =>He gave 间接宾语+直接宾语+界符
   =>He gave 代词+直接宾语+界符
   =>He gave 代词+直接宾语+界符
   =>He gave me 直接宾语+界符
   =>He gave me 冠词+名词+界符
   =>He gave me a book+界符
   =>He gave me a book.
```
除此之外还可以用语法分析树的方式来进行推导，比如：  

![img](assets/clip_image002-1564725064074.png)

另外还可以用状态转移图进行推导：

![img](assets/clip_image002-1564725293039.png)

上述定义英语句子的规则可以说就是一个上下文无关文法。  

总结起来，一个上下文无关文法包括四个组成部分：终结符号集（Vt）、非终结符号集（Vn）、一个开始符号（S）、一组产生式（∮）。  
**终结符号**：是组成语言的基本符号，就是在上文中经常提到的关键字、标识符、常量、算符、界符等等。从语法的角度来看，终结符号不可分割。  
**非终结符号**：也称语法变量，用来代表语法单位。例如算术表达式、布尔表达式、赋值句、循环等。我们也可以说，一个非终结符代表一个一定的语法概念，因此非终结符是对于一个集合的记号，每个非终结符使用终结符和非终结符组成的符号串。  
**开始符号**：开始符号是一个特殊的非终结符，它定义的语法单位是“句子”；开始符号必须在产生式集合中任意一条产生式的左部出现至少一次。  
**产生式**：产生是是定义语法单位的一种书写规则，一般的形式是：  
$$
A \to a
$$
其中，箭头左边的A是一个非终结符，称为产生式的**左部符号**，箭头右边的a是由终结符、|、非终结符共同组成的一个个符号串，称为产生式的**右部**。产生式是用来定义语法单位的，例如，令i代表已定义的单位“变量”，那么产生式“算术表达式->i”意味着吧算术表达式定义为变量。在Antlr中箭头一般用冒号来代替。  

## 递归的表达式

   大部分时候，只靠一个产生式不能很好的定义一个语法单位，需要用好几个产生式，甚至是递归的产生式。比如要真正的定义算术表达式的话，用产生式来描述，可以将它写成：
$$
E \to i \\
E \to E+E \\
E \to E*E \\
E \to (E)
$$
其中，E代表“算术表达式”，i代表“变量”，这四个产生式加起来才能定义整个“算术表达式”的概念，后三个产生式都是递归的，也就是**左部符号**直接在**右部**中出现。用递归方式定义语法是一种非常常见的手段，但是并不是所有递归多项上面的例子那么明显，可能会有间接递归，对此应该特别注意。
为了书写方便，将多个左部相同的产生式合写为一个，右部之间用‘|’相互隔开。  
一个上下文无关文法如何定义一个语言呢？中心思想是从文法的开始符号出发，按照产生式，对非终结符实行替换和展开。  

下面介绍几个简单的文法例子。  

例一、  考虑这个文法：
$$
S \to bA \\
A \to aA|a
$$
这个文法定义了一个什么样的语言？

例二、  请构造一个文法，使得最后的终结符串为a^nb^n的形式。

因为有一些句型的推导过程并不唯一，所以为了对句子结构进行确定的分析，我们往往只考虑最左推导和最右推导。最左推导是指：在任何一步推导当中，都是将右部表达式的最左侧的非终结符用相应的文法产生式进行替换。同样的，也可以定义最右推导。