# LL(1)文法的Parser

## LL(1)分析表与预测分析程序

当第一次开发一种语言的编译器的时候，标准的递归下降分析是不现实的。实现LL(1)更便捷有效的方案是用过一张分析表和一个符号栈来进行控制。预测分析程序就是这种思路的一个实现。

符号栈用于存放文法符号。分析开始时在栈底有一个#作为指示符和一个开始符号作为替换基准，同时假定每个输入串最后都同样有一个#做为结束分析的指示符。

### First()集与Follow()集的构造方法

#### First()集的构造方法

1. 如果一个产生式形如$$E \to a...$$，那么将a加入到First(E)中
2. 如果一个产生式形如$$E \to T...$$，那么将First(T)加入到First(E)中
3. $$E \to ε$$也是产生式，所以ε也要加入到First(E)
4. 如果一组产生式形如$$E \to TF$$，同时存在$$T \to ε$$，那么将First(F)加入到First(E)中

以上几条方法反复使用，直到非终结符的First()集不再扩大为止。

#### Follow()集的构造方法

1. 对于文法的开始符号S，将#置入Follow(S)
2. 如果一个产生式形如$$E \to ...T$$,那么将Follow(E)加入到Follow(T)中
3. 如果一个产生式形如$$E \to ...Ta$$,那么将a加入到Follow(T)中
4. 如果一个产生式形如$$E \to ...TF$$，同时有$$F \to ε$$，那么将Follow(F)加入到Follow(T)中
5. 如果一个产生式形如$$E \to ...TF$$，那么将First(F)加入到Follow(T)中

反复使用以上几条方法，直到非终结符的Follow()集不再扩大为止。

#### select()集的构造方法

select集是first集与follow集的某种形式的全集，用于统一填写LL(1)分析表的时候确定一个非终结符的候选推导。因为在进行推导的时候，假如

### LL(1)分析表构造过程

预测分析表是一个M[A,a]形式的矩阵，其中A是非终结符，a是终结符或者#（此时#是输入串的结束符号）。每个矩阵元素M[A,a]存放一条关于A的产生式，指使了当A遇到a的情况下应当采用哪种候选进行推导。例如针对文法
$$
E \to TE' \\
E' \to +TE'|ε \\
T \to FT’ \\
T' \to *FT'|ε \\
F \to (E)|i \\
$$
首先计算它的LL(1)分析表，根据产生式，可以得到每条产生式的First()集与Follow()集：

```
First(E):{i,(}
First(E'):{+,ε},Follow(E'):{),#}
First(T):{i,(}
First(T'):{*,ε},Follow(E'):{+,),#}
First(F):{i,(}
```

此后填表的时候，考虑文法在非终结符遇到First集合中的符号的时候，需要用那条产生式才能对应产生出这个符号来；如果First集合中有ε，则类似的考虑Follow集合。随后即可填写LL(1)分析表：

|      | i             | +               | *               | (             | )            | #            |
| ---- | ------------- | --------------- | --------------- | ------------- | ------------ | ------------ |
| E    | $$E \to TE'$$ |                 |                 | $$E \to TE'$$ |              |              |
| E'   |               | $$E' \to +TE'$$ |                 |               | $$E' \to ε$$ | $$E' \to ε$$ |
| T    | $$T \to FT'$$ |                 |                 | $$T \to FT'$$ |              |              |
| T'   |               | $$T' \to ε$$    | $$T' \to *FT'$$ |               | $$T' \to ε$$ | $$T' \to ε$$ |
| F    | $$F \to i$$   |                 |                 | $$F \to (E)$$ |              |              |

### 预测分析程序的工作过程
对于任何分析矩阵的项目M[X,a]，分析程序都执行如下三个动作之一：

1. 若X=a=#，则宣布分析成功，停止分析
2. 若X=a≠#，则将X从栈顶弹出，并让a指向下一个待分析句子中的文法符号
3. 若X是非终结符，则按照分析表的指示，寻找到对应产生式。先将X从栈顶弹出，然后将产生式右部的所有符号从右到左依次压栈。如果产生式右部是ε，那么只弹出X，不进行压栈操作
4. 项目M[X,a]对应的位置是空白的，则调用错误处理程序。

输入串i~1~*(i~2~+i~3~)\*i~4~的递归下降分析表,i的下标不影响它们的语义：

| 步骤 | 符号栈      | 输入串                  | 动作              | 产生式       |
| ---- | ----------- | ----------------------- | ----------------- | ---- |
| 0    | #E          | i~1~*(i~2~+i~3~)\*i~4~# | 替换 | $$E \to TE'$$ |
| 1    | #E’T        | i~1~*(i~2~+i~3~)\*i~4~#    | 替换              | $$T \to FT'$$ |
| 2    | #E’T’F      | i~1~*(i~2~+i~3~)\*i~4~#    | 替换              | $$F \to i$$   |
| 3 | #E’T’i | i~1~*(i~2~+i~3~)\*i~4~# | 弹出 |  |
| 4   | #E’T’       | *(i~2~+i~3~)\*i~4~#    | 替换          | $$T' \to *FT'$$ |
| 5   | #E’T’F*   | *(i~2~+i~3~)\*i~4~#     | 弹出 |  |
| 6   | #E’T’F  | (i~2~+i~3~)\*i~4~# | 替换 | $$F \to (E)$$ |
| 7   | #E’T’)E( | (i~2~+i~3~)\*i~4~# | 弹出 |  |
| 8   | #E’T’)E | i~2~+i~3~)\*i~4~# | 替换 | $$E \to TE'$$ |
| 9   | #E’T’)E’T   | i~2~+i~3~)\*i~4~# | 替换 | $$T \to FT'$$ |
| 10  | #E’T’)E’T’F | i~2~+i~3~)\*i~4~# | 替换 | $$F \to i$$ |
| 11 | #E’T’)E’T’i | i~2~+i~3~)\*i~4~# | 弹出 |  |
| 12 | #E’T’)E’T’ | +i~3~)\*i~4~#   | 弹出 | $$T’ \to ε$$ |
| 13 | #E’T’)E’ | +i~3~)\*i~4~#   | 替换 | $$E' \to +TE'$$ |
| 14 | #E’T’)E’T+ | +i~3~)\*i~4~#   | 弹出 |  |
| 15 | #E’T’)E’T | i~3~)\*i~4~#    | 替换 | $$T \to FT'$$ |
| 16 | #E’T’)E’T’F | i~3~)\*i~4~#     | 替换 | $$F \to i$$ |
| 17 | #E’T’)E’T’i | i~3~)\*i~4~#     | 弹出 |  |
| 18 | #E’T’)E’T’ | \)\*i~4~#         | 弹出 | $$T’ \to ε$$ |
| 19 | #E’T’)E’ | )\*i~4~#           | 弹出 | $$E’ \to ε$$ |
| 20 | #E’T’) | )\*i~4~#             | 弹出 |                 |
| 21 | #E’T’ | *i~4~#                 | 替换 | $$T' \to *FT'$$ |
| 22 | #E’T’F*   | *i~4~#                 | 弹出 |    |
| 23 | #E’T’F    | i~4~#                  | 替换 |  $$F \to i$$  |
| 24 | #E’T’i | i~4~# | 弹出 | |
| 25 | #E’T’ | # | 弹出 | $$T’ \to ε$$ |
| 26 | #E’ | # | 弹出 | $$E’ \to ε$$ |
| 27 | # | # | 分析成功 | |

