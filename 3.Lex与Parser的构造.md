# Lex与Parser的构造

## LEX的构造
### 词法分析器的功能
   词法分析的目的是读取字符流，输出单词符号流。大部分的程序语言中，单词符号分为以下五种：  
1.	关键字：由程序语言定义的固定含义的标识符。这些单词通常不用于表示一般自定义的标识符。  
2.	标识符：用来表示各种用户自定义的名称，例如变量名称、函数名称、类型/对象名称等。  
3.	常量：例如数、字符串、布尔常量等。  
4.	运算符：比如+、-、×、÷。  
5.	定界符：比如逗号、句号、分号、括号、注释符号等。  

### 词法分析器的输出形式
   为了方便此后的程序识别，一般使用一个编号来标记单词的种类，加上一定的属性，构成二元输出式形如：  
			（单词种类号码，单词符号属性值）
   单词种类号码一般采用整数编码，在分类上，一般按照语义接近的分为一组来执行；如果遇到多含义的单词也可以专门新开一个种类。定界符一般是每个符号一个种类。单词符号的属性一般表示单词的特征，比如多个int变量标识符之间，需要依靠属性值区分标识符的名称和实际值。  

### 分词的机制
   一种语言当中存在关键字和非关键字的区别，那么如何从一连串的字符中挑出它们？这就涉及到了分词的机制。分词的艺术在于如何正确巧妙的利用定界符、运算符、空白符甚至语法树来框定非关键字的范围。  
   首先我们需要一个记录所有关键字的列表。  
   如果希望严格的限定用户完全不能使用关键字做任何其他事情的话，那么可以在每识别一个符号的时候就去列表中查询，但是显然，一般的语言都不会采取这样严格的策略。  
   退而求其次的方案是，将一个单词（不论什么样的单词）作为一个整体进行查表的操作；这样只要关键字单独的出现，没有和其他组成标识符的符号混合在一起的话，就一定可以查出来。  
   如果要求关键字也可以作为标识符使用的话（比如Fortran），就需要基于缓冲的超前搜索、甚至语法树来辅助分析。  

#### 常数的识别
   常数识别的问题在于，要识别正负号和一个多义字符 '.'，如果要加上科学计数法或者数学常数的话那么情形会更加复杂。因此需要专门的常数处理函数，用来匹配状态转移图中关于常数的子图。  
#### 运算符与定界符的识别

   各种语言中，除了简单的单个符号组成的运算符或者定界符之外，还有很多由多个有意义的符号组成的多符号运算符/定界符，这些单词的识别只能使用超前搜索来解决。  

#### 超前搜索设计与分词方案

​	先看Fortran语言中的两个合法句子：  
① DO99K=1,10 （循环语句，变量名是99K）  
② DO99K=1.10 （赋值语句，变量名是DO99K）  

​	为了正确识别上两者的区别，我们读取了“DO”之后，不能马上判断这是一个关键字，需要先跳过中间所有符号去搜索下一个等号在哪里。如果有等号，接着扫描到下一个定界符，分辨出是逗号还是句号之后，才能反过来判定前面的“DO99K”到底是个什么东西。  

[^杂谈]: 不无恶意的揣度一下Fortran的设计方式，我严重怀疑他们是因为长度短的变量名称不够用才出此下策。用编译时的内存消耗来减少存储源代码的空间需求。这种语法设计对于观看的人来说无疑是非常不友好的。

##### 工程化分词艺术（原创）

​	如果你写的代码足够多，你就会由一定的感受：单个符号是分成多个种类的，单词和单词之间也是有一些自然的边界的。这些边界使得基于状态的超前搜索（我自己的命名）成为可能。  
​	例如，将字符分为以下几种：  
1. 无条件停顿字符：当遇到这样的符号时，无论如何都停下来，将缓冲区内的字符串进行查表操作，如果未找到对应单词的话按照已知状态进行处理。一般包含空格、换行、回车、分号。  
2. 字母字符：遇到这样的符号时，如果已知状态不是字母的话就停下来，将缓冲区内的字符串进行查表操作，否则将当前字符置入缓冲区。  
3. 符号字符：遇到这样的符号时，需要按照更加精细的判断决定当前字符是否应该加入到缓冲区中。因为符号当中会有一些特殊的字符，甚至在某些语言中的大部分符号都是有各种特殊意义的。此时就需要根据完整的词法定义，分割完整的状态转移图，生成针对不同类型单词的局部状态转移图，然后根据这些子图写单独的处理函数。例如针对浮点型数值，+/-/.就不能简单的认定成符号。  
4. 还有一个作为特例的单引号，这个需要单独识别。  

此后，针对符号字符的识别复杂度，设计如下的方案：  
1. 设计一个三状态枚举开关类，分别用stop、mark、letter标记三个状态。  
2. 逐字符读取语句，  

### 单词属性的识别

## Parser的构造
### 语法分析器的功能
语法分析器的任务是在词法分析识别出的单词符号流的基础上，分析并判定这个语句是否符合预定义的语法规则。

### 语法分析器的类型
1. 自动机类型：最为简单可工程化实现的方式，但是想要正确的、无歧义的分析语言还需要做很多重复工作。
2. 动作外置的语法树类型：外部总控程序为主，通过识别节点类型执行规定工作。
3. 动作内置的语法树类型：外部总控程序为辅，每个节点仅包含自身相关的动作。

### 语法分析器的构造

