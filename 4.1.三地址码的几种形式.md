# 三地址码的几种形式

下文当中会一直以a=b\*-c+b\*-c来举例。

## 直接三元式

三元式是一个带有三个域的记录结构，分别为op、arg1、arg2。op代表运算符（或者它的表示形式）；arg1、arg2代表三元式的两个操作数，或者是指向三元式表项首地址的指针。

对于取值一类的一目运算符，我们可以指定任意使用arg1或arg2其中的一个；对于间接寻址的三元式，我们可以规定arg1是源地址，arg2是间接地址。

这样就可以得到上文算数表达式的三元式执行表：

|      |   op   | arg1 | arg2 |
| :--: | :----: | :--: | :--: |
|  0   | uminus |  c   |      |
|  1   |   *    |  b   | (0)  |
|  2   | uminus |  c   |      |
|  3   |   *    |  b   | (2)  |
|  4   |   +    | (1)  | (3)  |
|  5   |   =    |  a   | (4)  |

## 四元式

四元式相比三元式，在每行上多出一个存放临时变量的域result，这样的好处是遇到各种转移语句的时候，转移目标标号可以直接放在result中；同时因为用了临时变量，在优化的时候可以极大的节约时间，这点在以后会提到。

|      |   op   | arg1 | arg2 | result |
| :--: | :----: | :--: | :--: | :----: |
|  0   | uminus |  c   |      |  T~1~  |
|  1   |   *    |  b   | T~1~ |  T~2~  |
|  2   | uminus |  c   |      |  T~3~  |
|  3   |   *    |  b   | T~3~ |  T~4~  |
|  4   |   +    | T~2~ | T~4~ |  T~5~  |
|  5   |   =    | T~5~ |      |   a    |

## 间接三元式

直接调整普通的三元式表是非常困难的，因为很多三元式之间通过指示器相互紧密连接。所以为了便于代码优化处理，我们可以另设一张间接码表，用来指示三元式表中的运算顺序。这样当需要重新调整运算顺序时，就可以简单的调整间接码表来达到目的。

另外由于另设了间接表，所以相同的三元式就无需重复填进三元式表，这样可以极大的节约空间。

|      |   op   | arg1 | arg2 |
| :--: | :----: | :--: | :--: |
|  0   | uminus |  c   |      |
|  1   |   *    |  b   | (0)  |
|  2   |   +    | (1)  | (1)  |
|  3   |   =    |  a   | (4)  |

|  间接代码表：    |
| ---- |
|  0   |
|  1   |
|  0   |
|  1   |
|  2   |
|  3   |

## 四元式与间接三元式的比较

四元式各项之间由于是通过临时变量连接起来的，而三元式各项之间关系与指示器标号有关，所以调整四元式的内部顺序比起三元式要简单很多。因此需要对中间代码进行优化处理的时候，四元式比三元式要简单很多；间接三元式与四元式相差不多。